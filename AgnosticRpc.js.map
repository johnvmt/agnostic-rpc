{"version":3,"sources":["node_modules/browser-pack/_prelude.js","AgnosticRpc.js","Utils.js"],"names":["AgnosticRpc","this","_requests","Utils","require","prototype","request","parsedArgs","parseArgs","arguments","name","level","validate","arg","allArgs","default","defaultOptions","multipleResponses","options","objectMerge","callback","requestId","uniqueId","query","id","handleResponse","message","response","handleRequest","requestMessage","requestCallback","responseEmitter","onResponse","responseMessage","messageIsResponse","messageIsRequest","module","exports","objectForEach","object","property","hasOwnProperty","merged","argument","attrname","s4","Math","floor","random","toString","substring","argsPassed","argsConfig","validArg","argConfig","requiredLeftEnough","minIndex","index","length","required","matched","argConfigMin","Array","isArray","slice","call","forEach","ctr"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","var Utils = require('./Utils');\n\nfunction AgnosticRpc() {\n\tthis._requests = {};\n}\n\nAgnosticRpc.prototype.request = function() {\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'query', level: 0,  validate: function(arg, allArgs) { return typeof arg != 'undefined'; }},\n\t\t\t{name: 'options', level: 1,  validate: function(arg, allArgs) { return typeof arg == 'object'; }, default: {}},\n\t\t\t{name: 'callback', level: 1,  validate: function(arg, allArgs) { return typeof(arg) === 'function'; }}\n\t\t]\n\t);\n\n\tvar defaultOptions = {\n\t\tmultipleResponses: false\n\t};\n\n\t// TODO add timeout option\n\tvar options = Utils.objectMerge(defaultOptions, parsedArgs.options); // merge options with defaults\n\n\tif(typeof parsedArgs.callback == 'function') {\n\t\tvar requestId = Utils.uniqueId();\n\t\tthis._requests[requestId] = {callback: parsedArgs.callback, options: options};\n\t}\n\n\tvar request = {\n\t\tquery: parsedArgs.query\n\t};\n\n\tif(typeof requestId != 'undefined')\n\t\trequest.id = requestId;\n\n\treturn request;\n};\n\nAgnosticRpc.prototype.handleResponse = function(message) {\n\tif(typeof message.id == 'string') { // responding to a logged request\n\t\tif(typeof this._requests[message.id] == 'object') { // request is logged\n\t\t\tvar request = this._requests[message.id];\n\t\t\tif(typeof request.callback == 'function') // valid callback is logged\n\t\t\t\trequest.callback(null, message.response); // callback with no error\n\t\t\tif(!request.options['multipleResponses'])\n\t\t\t\tdelete this._requests[message.id];\n\t\t}\n\t}\n\t// TODO trigger errors\n};\n\nAgnosticRpc.prototype.handleRequest = function(requestMessage, requestCallback, responseEmitter) {\n\tvar onResponse = function(response) {\n\t\tvar responseMessage = {\n\t\t\tresponse: response\n\t\t};\n\n\t\tif(typeof requestMessage.id == 'string')\n\t\t\tresponseMessage.id = requestMessage.id;\n\n\t\tresponseEmitter(responseMessage);\n\t};\n\n\trequestCallback(requestMessage.query, onResponse);\n\n\t// TODO trigger errors\n};\n\nAgnosticRpc.prototype.messageIsResponse = function(message) {\n\t// response to request from this node\n\treturn (typeof message.response != 'undefined');\n};\n\nAgnosticRpc.prototype.messageIsRequest = function(message) {\n\t// response to request from this node\n\treturn !this.messageIsResponse(message);\n};\n\nmodule.exports = function() {\n\treturn new AgnosticRpc();\n};","var Utils = {};\n\nUtils.objectForEach = function(object, callback) {\n\t// run function on each property (child) of object\n\tvar property;\n\tfor(property in object) { // pull keys before looping through?\n\t\tif (object.hasOwnProperty(property))\n\t\t\tcallback(object[property], property, object);\n\t}\n};\n\nUtils.objectMerge = function() {\n\tvar merged = {};\n\tthis.objectForEach(arguments, function(argument) {\n\t\tfor (var attrname in argument) {\n\t\t\tif(argument.hasOwnProperty(attrname))\n\t\t\t\tmerged[attrname] = argument[attrname];\n\t\t}\n\t});\n\treturn merged;\n};\n\nUtils.uniqueId = function() {\n\tfunction s4() {\n\t\treturn Math.floor((1 + Math.random()) * 0x10000)\n\t\t\t.toString(16)\n\t\t\t.substring(1);\n\t}\n\treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n\t\ts4() + '-' + s4() + s4() + s4();\n};\n\nUtils.parseArgs = function(argsPassed, argsConfig) {\n\tvar matched = {};\n\n\tfunction toLevels(argsConfig, level) {\n\t\tif(typeof level !== 'number')\n\t\t\tlevel = 0;\n\n\t\tvar levelsArr = [];\n\n\t\targsConfig.forEach(function(argConfig) {\n\t\t\tif(Array.isArray(argConfig))\n\t\t\t\tlevelsArr = levelsArr.concat(toLevels(argConfig, level + 1));\n\t\t\telse {\n\t\t\t\targConfig.level = level;\n\t\t\t\tlevelsArr.push(argConfig);\n\t\t\t}\n\t\t});\n\n\t\treturn levelsArr;\n\t}\n\n\tfunction validArg(argConfig, arg) {\n\t\treturn typeof argConfig.validate != 'function' || argConfig.validate(arg)\n\t}\n\n\tfunction requiredLeftEnough(argsConfig, minIndex) {\n\t\tfor(var index = minIndex; index < argsConfig.length; index++) {\n\t\t\tif(typeof(argsConfig[index]) === 'undefined' || !argsConfig[index].required)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tvar argConfigMin = 0;\n\n\tif(!Array.isArray(argsPassed))\n\t\targsPassed = Array.prototype.slice.call(argsPassed);\n\n\targsPassed.forEach(function(arg, index) {\n\t\tfor(var ctr = argConfigMin; ctr < argsConfig.length; ctr++) {\n\t\t\tif(argsConfig[ctr].required) {\n\t\t\t\tif(validArg(argsConfig[ctr], arg)) {\n\t\t\t\t\targsConfig[ctr].matched = true;\n\t\t\t\t\tmatched[argsConfig[ctr].name] = arg;\n\t\t\t\t\targConfigMin++;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthrow \"missing_required\";\n\t\t\t}\n\t\t\telse if((!argsConfig[ctr].required && (requiredLeftEnough(argsConfig, ctr) || (argsConfig[ctr].level > argsConfig[ctr - 1].level && argsConfig[ctr - 1].matched))) && validArg(argsConfig[ctr], arg)) {\n\t\t\t\targsConfig[ctr].matched = true;\n\t\t\t\tmatched[argsConfig[ctr].name] = arg;\n\t\t\t\targConfigMin++;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse {\n\t\t\t\targsConfig[ctr].matched = false;\n\t\t\t\targConfigMin++;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Add default options, if set\n\targsConfig.forEach(function(argConfig) {\n\t\tif(typeof matched[argConfig.name] == 'undefined' && typeof argConfig.default != 'undefined')\n\t\t\tmatched[argConfig.name] = argConfig.default;\n\t});\n\n\treturn matched;\n};\n\nmodule.exports = Utils;"]}