(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.AgnosticRpc = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function AgnosticRpc(){this._requests={}}var Utils=require("./Utils");AgnosticRpc.prototype.request=function(){var e=Utils.parseArgs(arguments,[{name:"query",level:0,validate:function(e,t){return"object"==typeof e}},{name:"options",level:1,validate:function(e,t){return"object"==typeof e},default:{}},{name:"callback",level:1,validate:function(e,t){return"function"==typeof e}}]),t={multipleResponses:!1},n=Utils.objectMerge(t,e.options);if("function"==typeof e.callback){var s=Utils.uniqueId();this._requests[s]={callback:e.callback,options:n}}var o={query:e.query};return"undefined"!=typeof s&&(o.id=s),o},AgnosticRpc.prototype.handleResponse=function(e){if("string"==typeof e.id&&"object"==typeof this._requests[e.id]){var t=this._requests[e.id];"function"==typeof t.callback&&t.callback(null,e.response),t.options.multipleResponses||delete this._requests[e.id]}},AgnosticRpc.prototype.handleRequest=function(e,t,n){var s=function(t){var s={response:t};"string"==typeof e.id&&(s.id=e.id),n(s)};t(e.query,s)},AgnosticRpc.prototype.messageIsResponse=function(e){return"undefined"!=typeof e.response},AgnosticRpc.prototype.messageIsRequest=function(e){return!this.messageIsResponse(e)},module.exports=function(){return new AgnosticRpc};
},{"./Utils":2}],2:[function(require,module,exports){
var Utils={};Utils.objectFilterProperties=function(e,t){var n={};return t.forEach(function(t){n[t]=e[t]}),n},Utils.objectContainsObject=function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&(!e.hasOwnProperty(n)||e[n]!=t[n]))return!1;return!0},Utils.objectFilter=function(e,t){var n={};return this.objectForEach(e,function(e,r,i){t(e,r,i)&&(n[r]=e)}),n},Utils.objectForEach=function(e,t){var n;for(n in e)e.hasOwnProperty(n)&&t(e[n],n,e)},Utils.objectGet=function(e,t){var n=this;if(0==t.length)return e;if("object"==typeof e){if(("string"==typeof t[0]||"number"==typeof t[0])&&null!==e&&e.hasOwnProperty(t[0]))return this.objectGet(e[t[0]],t.slice(1));if(null===t[0]){if(Array.isArray(e)){var r=[];e.forEach(function(e,i){r[i]=n.objectGet(e,t.slice(1))})}else{var r={};this.objectForEach(e,function(e,i){r[i]=n.objectGet(e,t.slice(1))})}return r}if(t[0]instanceof RegExp){var r={};return this.objectForEach(e,function(e,i){i.match(t[0])&&(r[i]=n.objectGet(e,t.slice(1)))}),r}if("function"==typeof t[0]){if(e instanceof Array){var r=[];e.forEach(function(e,i,o){t[0](e,i,o)&&(r[i]=n.objectGet(e,t.slice(1)))})}else{var r={};this.objectForEach(n.objectFilter(e,t[0]),function(e,i){r[i]=n.objectGet(e,t.slice(1))})}return r}if(t[0]instanceof Array){if(e instanceof Array){var r=[];t[0].forEach(function(t,n){r[n]=e[n]})}else{var r={};this.objectForEach(n.objectFilterProperties(e,t[0]),function(e,i){r[i]=n.objectGet(e,t.slice(1))})}return r}}},Utils.objectSet=function(e,t,n){return 1==t.length?(e[t[0]]=n,!0):("undefined"==typeof e[t[0]]&&(e[t[0]]={}),this._objectSet(e[t[0]],t.slice(1),n))},Utils.objectIsset=function(e,t){return 1==t.length?"undefined"!=typeof e[t[0]]:"undefined"!=typeof e[t[0]]&&this.objectIsset(e[t[0]],t.slice(1))},Utils.objectMerge=function(){var e={};return this.objectForEach(arguments,function(t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}),e},Utils.uniqueId=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},Utils.parseArgs=function(e,t){function n(e,t){return"function"!=typeof e.validate||e.validate(t)}function r(e,t){for(var n=t;n<e.length;n++)if("undefined"==typeof e[n]||!e[n].required)return!0;return!1}var i={},o=0;return Array.isArray(e)||(e=Array.prototype.slice.call(e)),e.forEach(function(e,c){for(var u=o;u<t.length;u++){if(t[u].required){if(n(t[u],e)){t[u].matched=!0,i[t[u].name]=e,o++;break}throw"missing_required"}if(!t[u].required&&(r(t,u)||t[u].level>t[u-1].level&&t[u-1].matched)&&n(t[u],e)){t[u].matched=!0,i[t[u].name]=e,o++;break}t[u].matched=!1,o++}}),t.forEach(function(e){"undefined"==typeof i[e.name]&&"undefined"!=typeof e.default&&(i[e.name]=e.default)}),i},Utils.callbackQueue=function(){function e(){r||(r=!0,n.queueCompleteCallback.apply(this,Array.prototype.slice.call(arguments)))}function t(){i++,"function"==typeof n.queueFunctions[i]?Array.isArray(n.queueFunctionArgs)&&!n.options.expand?n.queueFunctions[i](n.queueFunctionArgs,t,e):Array.isArray(n.queueFunctionArgs)&&n.options.expand?n.queueFunctions[i].apply(this,n.queueFunctionArgs.concat([t,e])):n.queueFunctions[i](t,e):"function"!=typeof n.queueNoMatchCallback||r||n.queueNoMatchCallback()}var n=Utils.parseArgs(arguments,[{name:"queueFunctions",level:0,validate:function(e,t){return Array.isArray(e)}},{name:"queueFunctionArgs",level:1,validate:function(e,t){return Array.isArray(e)}},{name:"queueCompleteCallback",level:0,validate:function(e,t){return"function"==typeof e}},{name:"queueNoMatchCallback",level:1,validate:function(e,t){return"function"==typeof e}},{name:"options",level:1,validate:function(e,t){return"object"==typeof e},default:{}}]);n.options=Utils.objectMerge({expand:!1},n.options);var r=!1,i=-1;t()},module.exports=Utils;
},{}]},{},[1])(1)
});


//# sourceMappingURL=AgnosticRpc.js.map