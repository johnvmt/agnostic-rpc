(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.AgnosticRpc = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function AgnosticRpc(){this._requests={}}var Utils=require("./Utils");AgnosticRpc.prototype.request=function(){var e=Utils.parseArgs(arguments,[{name:"query",level:0,validate:function(e,t){return"undefined"!=typeof e}},{name:"options",level:1,validate:function(e,t){return"object"==typeof e},default:{}},{name:"callback",level:1,validate:function(e,t){return"function"==typeof e}}]),t={multipleResponses:!1},n=Utils.objectMerge(t,e.options);if("function"==typeof e.callback){var s=Utils.uniqueId();this._requests[s]={callback:e.callback,options:n}}var o={query:e.query};return"undefined"!=typeof s&&(o.id=s),o},AgnosticRpc.prototype.handleResponse=function(e){if("string"==typeof e.id&&"object"==typeof this._requests[e.id]){var t=this._requests[e.id];"function"==typeof t.callback&&t.callback(null,e.response),t.options.multipleResponses||delete this._requests[e.id]}},AgnosticRpc.prototype.handleRequest=function(e,t,n){var s=function(t){var s={response:t};"string"==typeof e.id&&(s.id=e.id),n(s)};t(e.query,s)},AgnosticRpc.prototype.messageIsResponse=function(e){return"undefined"!=typeof e.response},AgnosticRpc.prototype.messageIsRequest=function(e){return!this.messageIsResponse(e)},module.exports=function(){return new AgnosticRpc};
},{"./Utils":2}],2:[function(require,module,exports){
var Utils={};Utils.objectForEach=function(r,e){var t;for(t in r)r.hasOwnProperty(t)&&e(r[t],t,r)},Utils.objectMerge=function(){var r={};return this.objectForEach(arguments,function(e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])}),r},Utils.uniqueId=function(){function r(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return r()+r()+"-"+r()+"-"+r()+"-"+r()+"-"+r()+r()+r()},Utils.parseArgs=function(r,e){function t(r,e){return"function"!=typeof r.validate||r.validate(e)}function n(r,e){for(var t=e;t<r.length;t++)if("undefined"==typeof r[t]||!r[t].required)return!0;return!1}var i={},a=0;return Array.isArray(r)||(r=Array.prototype.slice.call(r)),r.forEach(function(r,o){for(var f=a;f<e.length;f++){if(e[f].required){if(t(e[f],r)){e[f].matched=!0,i[e[f].name]=r,a++;break}throw"missing_required"}if(!e[f].required&&(n(e,f)||e[f].level>e[f-1].level&&e[f-1].matched)&&t(e[f],r)){e[f].matched=!0,i[e[f].name]=r,a++;break}e[f].matched=!1,a++}}),e.forEach(function(r){"undefined"==typeof i[r.name]&&"undefined"!=typeof r.default&&(i[r.name]=r.default)}),i},module.exports=Utils;
},{}]},{},[1])(1)
});


//# sourceMappingURL=AgnosticRpc.js.map